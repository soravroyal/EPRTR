use EPRTRmaster
--SET QUOTED_IDENTIFIER ON

--exec EPRTRxml.dbo.import_xml	-- AUSTRIA
--	'http://cdr.eionet.europa.eu/at/eu/eprtrdat/envskhwsq/PRTR_2007_AT.xml',
-- 	'2009-06-30 15:02:00',
-- 	'2009-06-30 15:16:34',
--	'first import'
	
--exec EPRTRxml.dbo.import_xml	-- BELGIUM
--	'http://cdr.eionet.europa.eu/be/eu/eprtrdat/envskoayg/EPRTR-BE300609.xml',
-- 	'2009-06-30 16:06:00',
-- 	'2009-06-30 16:16:12',
--	'first import'
	
--exec EPRTRxml.dbo.import_xml	-- BULGARIA
--	'http://cdr.eionet.europa.eu/bg/eu/eprtrdat/envskizbg/2007_Report.xml',
-- 	'2009-06-29 14:27:00',
-- 	'2009-06-29 14:28:17',
--	'first import'

--exec EPRTRxml.dbo.import_xml	-- CYPRUS
--	'http://cdr.eionet.europa.eu/cy/eu/eprtrdat/envsi9taq/output.xml',
-- 	'2009-06-30 09:31:00',
-- 	'2009-06-30 09:33:58',
--	'first import'
	
--exec EPRTRxml.dbo.import_xml	-- CHECH REPUBLIC
--	'http://cdr.eionet.europa.eu/cz/eu/eprtrdat/envskizsw/report_CZ_E_PRTR_2007.xml',
-- 	'2009-06-29 14:39:00',
-- 	'2009-06-29 14:44:56',
--	'first import'
	
--exec EPRTRxml.dbo.import_xml	-- DENMARK
--	'http://cdr.eionet.europa.eu/dk/eu/eprtrdat/envsktaqa/PRTR_Rapport_2007_260609_uden_bilag_II_alle_accidential.xml',
-- 	'2009-06-26 14:35:00',  
-- 	'2009-06-26 14:39:21',
--	'first import'

--exec EPRTRxml.dbo.import_xml	-- ESTONIA
--	'http://cdr.eionet.europa.eu/ee/eu/eprtrdat/envsktb6a/EPRTR_2007_EE_final.xml',
-- 	'2009-06-30 11:17:00',
-- 	'2009-06-30 12:52:59',
--	'first import'
		
--exec EPRTRxml.dbo.import_xml	-- FINLAND
--	'http://cdr.eionet.europa.eu/fi/eu/eprtrdat/envsivqjg/E-PRTR_data_FI_2007_-_v1.1.xml',
--	'2009-06-05 13:53:00',
--	'2009-06-26 13:19:45',
--	'first import'

--exec EPRTRxml.dbo.import_xml	-- FRANCE
--	'http://cdr.eionet.europa.eu/fr/eu/eprtrdat/envsktjeg/etx_20090626_0900_version_2.xml',
-- 	'2009-06-26 17:05:00',
-- 	'2009-06-26 17:06:50',
--	'second import'

--exec EPRTRxml.dbo.import_xml	-- GERMANY
--	'http://cdr.eionet.europa.eu/de/eu/eprtrdat/envskjhnq/XML3-20090624_1614-.xml',
-- 	'2009-06-29 16:02:00',  
-- 	'2009-06-29 16:02:30',
--	'first import'
	
--exec EPRTRxml.dbo.import_xml	-- IRELAND
--	'http://cdr.eionet.europa.eu/ie/eu/eprtrdat/envsjpklq/EUReport_2007_Final_v1.xml',
-- 	'2009-06-25 10:10:00',
-- 	'2009-06-30 11:22:44',
--	'first import'

--exec EPRTRxml.dbo.import_xml	-- ITALY
--	'http://cdr.eionet.europa.eu/it/eu/eprtrdat/envsksja/EPRTR_2007_IT_v2.xml',
-- 	'2009-07-01 12:59:00',
-- 	'2009-07-01 12:59:25',
--	'second import'
	
--exec EPRTRxml.dbo.import_xml	-- LICHTENSTEIN
--	'http://cdr.eionet.europa.eu/li/eu/eprtrdat/envsjioqq/LI_090619.xml',
--	'2009-06-23 10:01:00',
--	'2009-06-23 10:02:54',
--	'first import'

--exec EPRTRxml.dbo.import_xml	-- LITHUANIA
--	'http://cdr.eionet.europa.eu/lt/eu/eprtrdat/envskigg/E-PRTR_LT.xml',
--	'2009-06-29 15:21:00',
--	'2009-06-30 11:58:57',
--	'first import'

--exec EPRTRxml.dbo.import_xml	-- NETHERLANDS
--	'http://cdr.eionet.europa.eu/nl/eu/eprtrdat/envskshia/output.xml',
--	'2009-06-29 22:57:00',
--	'2009-06-29 22:59:35',
--	'first import'

--exec EPRTRxml.dbo.import_xml	-- NORWAY
--	'http://cdr.eionet.europa.eu/no/eu/colp0rva/colsex26g/envsknlzg/eprtr_020.xml',
--	'2009-06-26 14:58:00',
--	'2009-06-29 08:30:07',
--	'first import'

--exec EPRTRxml.dbo.import_xml	-- POLAND
--	'http://cdr.eionet.europa.eu/pl/eu/eprtrdat/envski4zq/raport2007r..xml',
--	'2009-06-29 14:56:00',
--	'2009-06-29 14:59:16',
--	'first import'

--exec EPRTRxml.dbo.import_xml	-- ROMANIA
--	'http://cdr.eionet.europa.eu/ro/eu/eprtrdat/envskhteq/eu_extract.xml',
--	'2009-06-29 09:32:00',
--	'2009-06-29 09:37:27',
--	'first import'

--exec EPRTRxml.dbo.import_xml	-- SLOVAKIA
--	'http://cdr.eionet.europa.eu/sk/eu/eprtrdat/envskn9ga/nrz_2007.xml',
--	'2009-06-30 13:59:00',
--	'2009-06-30 14:01:27',
--	'first import'

--exec EPRTRxml.dbo.import_xml	-- SLOVENIA
--	'http://cdr.eionet.europa.eu/si/eu/eprtrdat/envsknnsq/PRTR_report_2008_final.xml',
--	'2009-06-30 10:40:00',
--	'2009-06-30 10:44:58',
--	'first import'

--exec EPRTRxml.dbo.import_xml	-- SPAIN
--	'http://cdr.eionet.europa.eu/es/eu/eprtrdat/envski7jw/2007_29062009_53001.xml',
--	'2009-06-29 17:43:00',
--	'2009-06-29 18:54:24',
--	'first import'

--exec EPRTRxml.dbo.import_xml	-- SWEDEN
--	'http://cdr.eionet.europa.eu/se/eu/colseypfq/envskt_kq/Rapportering_-_EPRTR_2007_v.3.xml',
--	'2009-07-01 17:20:00',
--	'2009-07-01 17:27:34',
--	'third import'

	
	
	
	
	
	
	
	
	

--use EPRTRmaster
--select * from 	dbo.vAT_POLLUTANTRELEASEANDTRANSFERREPORT prtr 
--where LOV_CountryID = 234
--order by 3,2

SELECT m.nr, count(m.FacilityID)
from FACILITYREPORT frep 
inner join dbo.vAT_POLLUTANTRELEASEANDTRANSFERREPORT prtr
on	frep.PollutantReleaseAndTransferReportID = prtr.PollutantReleaseAndTransferReportID
left outer join (
	select COUNT(*) as nr,FacilityID 
	from FACILITYREPORT frep inner join dbo.vAT_POLLUTANTRELEASEANDTRANSFERREPORT prtr
	on frep.PollutantReleaseAndTransferReportID = prtr.PollutantReleaseAndTransferReportID
	where LOV_CountryID = 234
	group by FacilityID
) m
on m.FacilityID = frep.FacilityID
where LOV_CountryID = 234
and ReportingYear = 2007
group by m.nr

use EPRTRmaster
select 
	ReportingYear,
	(geography::STPointFromText(GeographicalCoordinate.STAsText(),4326)).Lat,
	(geography::STPointFromText(GeographicalCoordinate.STAsText(),4326)).Long,
	frep.LOV_StatusID, *
from FACILITYREPORT frep inner join dbo.vAT_POLLUTANTRELEASEANDTRANSFERREPORT prtr
on frep.PollutantReleaseAndTransferReportID = prtr.PollutantReleaseAndTransferReportID
where LOV_CountryID = 109
and ReportingYear = 2007
order by 3

--use EPRTRweb
--select * from FACILITYDETAIL_DETAIL
--where CountryCode = 'DE'
--and ReportingYear = 2007
--order by CoordinateStatusCode

--select * from EPRTRxml.dbo.FacilityReport